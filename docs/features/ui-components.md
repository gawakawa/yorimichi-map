# 🎨 UI機能

## レイアウト構成

AI Drive Buddyは2カラムレイアウトを採用しています：

- **左側**: チャット & プランニングエリア
- **右側**: 地図 & アクションエリア

## 左パネル（チャット & プランニング）

### チャットインターフェース

- **会話形式**: ユーザーとAIの対話を時系列で表示
- **メッセージ履歴**: セッション中の全ての会話を保持
- **入力フォーム**: テキスト入力でAIに要望を伝える

### 旅のスポットリスト

- 確定した経由地を一覧表示
- 各スポットの情報（名前、評価、住所）
- スポットの追加・削除機能

### 帰りのルート作成ボタン

**機能**: 「🔄 帰りのルートを作成」ボタン
- ワンクリックで帰路を自動生成
- 経由地を逆順に設定
- 出発地と目的地を入れ替え

## 右パネル（地図 & アクション）

### インタラクティブ地図

**技術**: Foliumライブラリ

**表示内容**:

- ルートを青い線で可視化
- 出発地に緑のマーカー（Play アイコン）
- 目的地に赤のマーカー（Flag アイコン）
- 経由地にマーカー表示

**インタラクション**:

- ズーム・パン操作
- マーカークリックで情報表示
- ルート線のハイライト

### ルートサマリー

**表示情報**:

- ⏱️ 所要時間（交通情報考慮）
- 📏 距離（km）
- 💴 通行料金（概算）
- 🚗 経由地リスト

### Googleマップ起動ボタン

**外観**:

- 🚀 「Googleマップでナビ開始」
- プライマリカラー（目立つ青）
- 幅100%のフルワイドボタン

**動作**:

- クリックでGoogleマップアプリを起動
- 経由地を含むルートが自動設定
- モバイル・デスクトップ両対応

### 帰路作成セクション

**位置**: 地図エリアの下部

**コンポーネント**:

- セクション見出し: 「🏠 帰りのルート作成」
- ボタン: 「🔄 経由地を逆にして帰宅ルートを提案」

**動作**:

1. ボタンクリック
2. 経由地を逆順に変換
3. AIに自動で指示を送信
4. 新しいルートを計算
5. 地図を更新

## 状態管理

### セッション状態

Streamlitのセッション状態を使用して以下を管理：

```python
st.session_state.messages = []          # チャット履歴
st.session_state.current_route = None   # 現在のルート情報
st.session_state.chat = None            # AIチャットセッション
```

### リアルタイム更新

- **Function Calling完了時**: 地図を自動更新
- **ルート確定時**: サマリー情報を更新
- **帰路作成時**: チャットエリアとマップを同期更新

## エラー表示

### APIエラー

```python
st.error("API Keyが設定されていません。.envファイルを確認してください。")
```

### ルート検索エラー

```python
st.error("ルートが見つかりませんでした。場所の名称を確認してください。")
```

### ローディング表示

```python
with st.spinner("AIがルートとスポットを検索中..."):
    # API実行
```

## レスポンシブデザイン

### デスクトップ

- 2カラムレイアウト（50% / 50%）
- 地図の高さ: 400px
- フルワイドボタン

### モバイル

- 縦並びレイアウト（Streamlitの自動レスポンシブ）
- チャットエリアが上部
- 地図エリアが下部
- タッチ操作対応

## アクセシビリティ

- **コントラスト**: 十分な色のコントラスト
- **ボタンサイズ**: タッチターゲット44px以上
- **アイコン**: 絵文字で視覚的なヒント
- **エラーメッセージ**: 明確でわかりやすい表現
