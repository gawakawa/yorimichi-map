# 🏗️ システムアーキテクチャ

## システム構成図

```text
┌─────────────────────────────────────────────────────────────┐
│                    ユーザー（ドライバー）                      │
└────────────────────┬────────────────────────────────────────┘
                     │ チャット & アクション
                     ▼
┌─────────────────────────────────────────────────────────────┐
│              フロントエンド (Streamlit)                        │
└────────────────────┬────────────────────────────────────────┘
                     │ プロンプト + コンテキスト
                     ▼
┌─────────────────────────────────────────────────────────────┐
│         Google Cloud / バックエンド                           │
│  ┌──────────────────────────────────────────────────┐       │
│  │  Vertex AI (Gemini 1.5 Pro)                      │       │
│  └──────────┬───────────────────────────────────────┘       │
│             │ Function Calls                                 │
│             ▼                                                 │
│  ┌──────────────────────────────────────────────────┐       │
│  │  ツールマネージャー                                 │       │
│  │  ├─→ Google Maps Routes API                      │       │
│  │  └─→ Google Maps Places API (New)                │       │
│  └──────────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────┘
                     │ ディープリンク
                     ▼
┌─────────────────────────────────────────────────────────────┐
│          Google Maps アプリ (iOS/Android)                     │
└─────────────────────────────────────────────────────────────┘
```

## コンポーネント詳細

### フロントエンド (Streamlit)

- **役割**: ユーザーインターフェース、チャット、地図表示
- **技術**: Streamlit, Folium (地図可視化)
- **機能**:
  - 会話型インターフェース
  - リアルタイム地図表示
  - Googleマップ起動ボタン
  - 帰路作成機能

### AI エンジン (Vertex AI - Gemini 1.5 Pro)

- **役割**: 自然言語理解、Function Calling、ルート推論
- **機能**:
  - ユーザーの曖昧な要望を解釈
  - 適切なAPI関数を呼び出し
  - 結果を分析して推薦を提供

### ツールマネージャー

#### Google Maps Routes API
- ルート計算
- 交通情報考慮
- 通行料金算出
- 所要時間予測

#### Google Maps Places API (New)
- スポット検索
- 評価・レビュー取得
- 写真情報
- 価格帯情報

### Googleマップアプリ連携

- **ディープリンク**: ワンタップでナビ開始
- **経由地自動設定**: 手動入力不要
- **シームレスなハンドオフ**: プランニングから実行まで

## データフロー

1. **ユーザー入力** → Streamlitチャット
2. **自然言語処理** → Gemini AI
3. **Function Calling** → Maps API実行
4. **結果統合** → AIが分析・推薦
5. **地図可視化** → Foliumでレンダリング
6. **アクション** → Googleマップディープリンク生成
